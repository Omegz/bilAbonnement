<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Dataregistrering - Opret lejeaftale</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    .card { max-width: 760px; border: 1px solid #ddd; padding: 18px; border-radius: 10px; }
    .row { display: flex; gap: 12px; margin-bottom: 12px; }
    .field { flex: 1; }
    label { display:block; margin-bottom: 6px; font-weight: 600; }
    input, select, button { width: 100%; padding: 8px; font-size: 14px; }
    button { width: auto; padding: 10px 14px; cursor: pointer; }
    .fejl { color: #b00020; margin: 10px 0; }
    .hint { font-size: 12px; color: #666; margin-top: 6px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1>Dataregistrering: Opret lejeaftale</h1>

<div class="card">
  <div th:if="${fejl}" class="fejl" th:text="${fejl}"></div>

  <form th:action="@{/data/lejeaftale/opret}" th:object="${form}" method="post">

    <div class="row">
      <div class="field">
        <label for="kundeId">Kunde</label>
        <select id="kundeId" th:field="*{kundeId}" required>
          <option value="">-- vælg kunde --</option>
          <option th:each="k : ${kunder}"
                  th:value="${k.id}"
                  th:text="${k.navn}"></option>
        </select>
        <div class="hint">Kunder hentes fra databasen (oprettes under /kunder).</div>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="bilId">Bil</label>
        <select id="bilId" th:field="*{bilId}" required>
          <option value="">-- vælg bil --</option>
          <option th:each="b : ${biler}" th:value="${b.id}" th:text="${b.navn}"></option>
        </select>
      </div>
      <div class="field">
        <label for="maanedligPris">Månedlig pris (DKK)</label>
        <input id="maanedligPris" type="number" step="0.01" th:field="*{maanedligPris}" required>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="startdato">Startdato</label>
        <input id="startdato" type="date" th:field="*{startdato}" th:attr="min=${today}" required>
        <div class="hint">Startdato kan kun være i dag eller frem i tiden.</div>
      </div>
      <div class="field">
        <label for="slutdato">Slutdato (valgfri)</label>
        <input id="slutdato" type="date" th:field="*{slutdato}">
        <div class="hint">Hvis tom beregnes slutdato automatisk ud fra kontrakten.</div>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="kontraktType">Kontrakttype</label>
        <select id="kontraktType" th:field="*{kontraktType}">
          <option value="LIMITED">Limited (150 dage)</option>
          <option value="UNLIMITED">Unlimited (3–36 måneder)</option>
        </select>
      </div>

      <div class="field">
        <label for="kontraktVarighedDage">Varighed (dage) – kun Unlimited</label>
        <input id="kontraktVarighedDage" type="number" th:field="*{kontraktVarighedDage}" placeholder="fx 90, 180, 365">
        <div class="hint">Unlimited: 90–1080 dage. Limited er fast 150 dage.</div>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="udleveringsstedType">Udleveringssted</label>
        <select id="udleveringsstedType" th:field="*{udleveringsstedType}">
          <option value="BILABONNEMENT">Bilabonnement</option>
          <option value="FDM">FDM</option>
          <option value="DS">DS-forhandler</option>
        </select>
      </div>

      <div class="field">
        <label for="leveringsform">Leveringsform</label>
        <select id="leveringsform" th:field="*{leveringsform}">
          <option value="AFHENTNING">Afhentning</option>
          <option value="LEVERING">Levering</option>
        </select>
      </div>
    </div>

    <div id="adresseWrap" class="row hidden">
      <div class="field">
        <label for="leveringsadresse">Leveringsadresse</label>
        <input id="leveringsadresse" type="text" th:field="*{leveringsadresse}" placeholder="Vejnavn 1, 2100 København Ø">
        <div class="hint">Kun nødvendig når leveringsform er LEVERING.</div>
      </div>
    </div>

    <hr style="margin: 16px 0;">

    <div class="row">
      <div class="field">
        <label for="medarbejderNavn">Medarbejder-navn</label>
        <input id="medarbejderNavn" type="text" th:field="*{medarbejderNavn}" required>
      </div>
      <div class="field">
        <label for="medarbejderPassword">Medarbejder-password</label>
        <input id="medarbejderPassword" type="password" th:field="*{medarbejderPassword}" required>
      </div>
    </div>

    <div class="hint">MVP: ekstra kontrol ved submit. Kun DATAREGISTRERING må oprette lejeaftaler.</div>

    <div style="margin-top: 14px;">
      <button type="submit">Opret lejeaftale</button>
    </div>

  </form>
</div>

<script>
  const leveringsform = document.getElementById('leveringsform');
  const adresseWrap = document.getElementById('adresseWrap');
  const adresseInput = document.getElementById('leveringsadresse');

  function toggleAdresse() {
    const isLevering = leveringsform.value === 'LEVERING';
    adresseWrap.classList.toggle('hidden', !isLevering);
    adresseInput.required = isLevering;
  }

  leveringsform.addEventListener('change', toggleAdresse);
  toggleAdresse(); // init
</script>

</body>
</html>
